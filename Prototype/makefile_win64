# Please run the clean command detailed at the bottom before running: make -f makefile_win64

# This make file works. Please do not modify it unless you're at a windows computer and can test it.
# Linux terminal commands are not the same as windows ones - many of the make commands that were
# in here were not workined at all on Windows.


# These are system independent
CFLAGS = -pedantic -Wall -Wextra -Wno-unused-variable -Wno-unused-parameter

# File structure variables
ASSETS_CONTENTS = assets
OBJS = main.o init.o game.o world_generation.o game_objects.o AI.o UI.o generic.o controls.o graphics.o audio.o
BIN = bin
PROG = $(BIN)/Prototype
CXX = gcc
ifeq ($(OS),Windows_NT)
	ifeq ($(PROCESSOR_ARCHITECTURE),AMD64)
		SDL_FLAGS = -ISDL2_x64/include -LSDL2_x64/lib
		DLL_LOCATION = SDL2_x64
	endif
	ifeq ($(PROCESSOR_ARCHITECTURE),x86)
		SDL_FLAGS = -ISDL2_x32/include -LSDL2_x32/lib
		DLL_LOCATION = SDL2_x32
	endif
	LFLAGS =  $(SDL_FLAGS) -lmingw32 -lSDL2main -lSDL2 -lSDL2_mixer  -lm
	DELETE = del
	DELETE_RECURSIVE = del /s
	DLL_COPY_COMMAND = xcopy $(DLL_LOCATION) $(BIN) /C /Y
	ASSET_COPY_COMMAND = xcopy $(ASSETS_CONTENTS) $(BIN) /C /E /Y
else
	SDL_FLAGS = -I/opt/SDL/2.0.3/include -L/opt/SDL/2.0.3/lib
	LFLAGS = $(SDL_FLAGS) $(TTF_FLAGS) -Wl,-rpath,/opt/SDL/2.0.3/lib -lSDL2 -lm
	DELETE = rm
	DELETE_RECURSIVE = rm -r
	DLL_COPY_COMMAND = echo "linux rocks"
	ASSET_COPY_COMMAND = cp -R $(ASSETS_CONTENTS) $@
endif

# List all the files here

# top-level rule to create the program.
all: $(PROG)


# compiling other source files.
%.o: src/%.c src/%.h
	$(CXX) $(CFLAGS) $(LFLAGS) -c -s $<

# linking the program. | $(BIN) makes the bin/ directory if it does not yet exist.
$(PROG): $(OBJS) | $(BIN)
	$(CXX) $(OBJS) -o $(PROG) $(LFLAGS)

# makes bin/ directory and copies assets to bin/ so we don't have to drag them in manually.
$(BIN):
	mkdir $@
	$(DLL_COPY_COMMAND)
	$(ASSET_COPY_COMMAND)

# cleans everything that can be automatically recreated with "make".
# To do this, run the following command in verdant-octo-spork/Prototype: make -f makefile_win64 clean
clean:
	$(DELETE) *.o
	$(DELETE_RECURSIVE) $(BIN)
